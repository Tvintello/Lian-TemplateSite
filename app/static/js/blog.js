$((function(){var e=mixitup(".blog__list",{callbacks:{onMixStart(e,s){s.hasFailed||0==$(".blog__list").children().length?($(".blog__background").removeClass("blog__background--hide"),$(".blog__warning").removeClass("blog__background--hide")):($(".blog__background").addClass("blog__background--hide"),$(".blog__warning").addClass("blog__background--hide"))},onMixEnd(e){$(".offer-list").get(0).scrollWidth>$(".offer-list").get(0).offsetWidth&&!e.hasFailed?$(".load-btn").removeClass("load-btn--disable"):$(".load-btn").addClass("load-btn--disable")}}});$(".offer-list").get(0).scrollWidth>$(".offer-list").get(0).offsetWidth?$(".load-btn").removeClass("load-btn--disable"):$(".load-btn").addClass("load-btn--disable"),$(".blog__list__item-like-btn").on("click",(function(){var e,s=$(this).attr("data-postid");$(this).hasClass("blog__list__item-btn--active")?($(this).removeClass("blog__list__item-btn--active"),e=-1):($(this).addClass("blog__list__item-btn--active"),e=1),$.post("/like_post",{action:e,id:s})})),$(".blog__load-btn").on("click",(function(){$(".blog__list").addClass("blog__list--stretch"),$(this).addClass("load-btn--disable"),post_number=20,length=$(".blog__list").children.length,async function(){await fetch(`/blog/load_more?p=${post_number+length}&l=${length}`).then((s=>{s.json().then((s=>{for(p of(console.log(s),s)){let s=$("#blog_item").clone().prop("id","");p.heading_image?s.find(".blog__list__item-image img").prop("src",p.heading_image):s.find(".blog__list__item-image").remove(),s.find(".blog__list__item-edit_btn").prop("href",p.edit),s.find(".blog__list__item-tag").html(p.tag),s.find(".blog__list__item-title").html(p.title),s.find(".blog__list__item-user").html(p.user_name),s.find(".blog__list__item-like-btn").addClass(p.liked),s.find(".blog__list__item-like-btn").attr("data-postid",p.id),s.find(".blog__list__item-description").html(p.text.replace(/<[^>]*>/g,"")),s.find(".blog__list__item-date").html(p.date),s.addClass(s.attr("data-filt")+p.tag),e.append(s).then((function(e){console.log(e.show.length)})),$(".blog__list").append(s)}}))}))}()})),$(".aside__tags__list-item").on("click",(function(){$(this).hasClass("aside__tags__list-item--active")?(e.show(),$(".aside__tags__list-item").removeClass("aside__tags__list-item--active")):($(".aside__tags__list-item").removeClass("aside__tags__list-item--active"),$(this).addClass("aside__tags__list-item--active"))})),$(".aside-burger").on("click",(function(){$(".aside__mobile").addClass("aside__mobile--active"),$("main").addClass("main--blackout")})),$(".aside__close-btn").on("click",(function(){$(".aside__mobile").removeClass("aside__mobile--active"),$("main").removeClass("main--blackout")})),window.innerWidth<=1200?$(".aside").addClass("aside__mobile"):($(".aside").removeClass("aside__mobile"),$(".aside__close-btn").css("display","none")),window.addEventListener("resize",(()=>{window.innerWidth<=1200?($(".aside").addClass("aside__mobile"),$(".aside__close-btn").css("display","block")):($(".aside__close-btn").css("display","none"),$(".aside").removeClass("aside__mobile"),$(".aside").removeClass("aside__mobile--active"),$("main").removeClass("main--blackout"))})),$(".aside__search-input").focus((function(){$(".search_results").css("display","block"),$(".wrapper").addClass("wrapper--blackout"),$(".aside__search").addClass("aside__search--focused"),$(".wrapper--blackout").click((function(){$(".search_results:hover").length||$(".aside__search:hover").length||($(".search_results").css("display","none"),$(".wrapper").removeClass("wrapper--blackout"),$(".aside__search").removeClass("aside__search--focused"))}))})),$(".aside__search").click((function(){$(".search_results").css("display","block"),$(".wrapper").hasClass("wrapper--blackout")||($(".aside__search").addClass("aside__search--focused"),$(".wrapper").addClass("wrapper--blackout"))})),$(".aside__search-input").on("input",(async function(){let e=$(this).val();await fetch(`/blog/search/json?q=${e.replace(" ","_")}`).then((function(s){s.json().then((function(s){$(".search_results").empty();let a=s[0];if(console.log(a),0==a.length)return $(".search_results").append($("<p>No results</p>")),void $(".aside__search-predicted").html("");for(post of(a=a.sort(((e,s)=>s.score-e.score)),a)){let e=$(`<a href="/blog/${post.id}" class="search_results__link"><div class="search_results__item"><div class="search_results__caption">${post.caption}</div><div class="search_results__text">${post.text}</div></div></a>`);$(".search_results").append(e)}if(s[1].length)for(p of s[1].slice(0,6)){inp=$(".aside__search-predicted").html(e.replace(/\s/gu,"&nbsp"));let s=inp.width()+ +$(".aside__search").css("padding-left").match(/\d*/u);$(".aside__search-predicted").css("left",`${s}px`),e.length+1>=p.caption.length?$(".aside__search-predicted").html(""):$(".aside__search-predicted").html(p.caption.slice(e.length,p.caption.length).replace(" ","&nbsp"))}else $(".aside__search-predicted").html("")}))}))}))}));